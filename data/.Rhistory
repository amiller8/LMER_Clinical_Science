getwd()
setwd("C:/Users/u6015231/Documents/GitHub/LMER_Clinical_Science")
list.files()
# Import the .csv file into R.
# We will save this file in the R environment as an object called "DATA".
DATA<-read.csv("./data_session1.csv", header = TRUE, sep=",",
na.strings=c("NA","NaN"," ",""))
# Import the .csv file into R.
# We will save this file in the R environment as an object called "DATA".
DATA<-read.csv("./data/data_session1.csv", header = TRUE, sep=",",
na.strings=c("NA","NaN"," ",""))
# Use the head() function to check the structure of the data file.
head(DATA)
# Understanding basic random-effects ------------------------------------------
# Random Intercepts Model ----
raneff_00<-lmer(rasch_FIM~
# Fixed-effects
1+
# Random-effects
(1|subID), data=DATA, REML=FALSE)
summary(raneff_00)
# Fixed Slope Model ----
raneff_01<-lmer(rasch_FIM~
# Fixed-effects
1+month+
# Random-effects
(1|subID), data=DATA, REML=FALSE)
summary(raneff_01)
# Random Slopes and Intercepts Model ----
raneff_02<-lmer(rasch_FIM~
# Fixed-effects
1+month+
# Random-effects
(1+month|subID), data=DATA, REML=FALSE)
summary(raneff_02)
# Main-Effect Model: Equivalent to Conditional Intercepts
cond_00<-lmer(rasch_FIM~
# Fixed-effects
1+year.0+AIS_grade+
# Random-effects
(1+year.0|subID), data=DATA, REML=FALSE)
summary(cond_00)
# The first time variable, year0 will set the first assessment equal to 0
DATA$year<-DATA$month/12
DATA$year.0<-DATA$year-min(DATA$year)
summary(DATA$year.0)
# Next, we will create a mean centered time variable, year.c:
mean(DATA$year)
DATA$year.c<-DATA$year-mean(DATA$year)
summary(DATA$year.c)
# Time 0 = the first time time point ----
time_00<-lmer(rasch_FIM~
# Fixed-effects
1+year.0+
# Random-effects
(1+year.0|subID), data=DATA, REML=FALSE)
summary(time_00)
# Time 0 = the mean time of 0.79 years ----
time_01<-lmer(rasch_FIM~
# Fixed-effects
1+year.c+
# Random-effects
(1+year.c|subID), data=DATA, REML=FALSE)
summary(time_01)
# Main-Effect Model: Equivalent to Conditional Intercepts
cond_00<-lmer(rasch_FIM~
# Fixed-effects
1+year.0+AIS_grade+
# Random-effects
(1+year.0|subID), data=DATA, REML=FALSE)
summary(cond_00)
# Interaction Model: Conditional Intercepts and Slopes
cond_01<-lmer(rasch_FIM~
# Fixed-effects
1+year.0*AIS_grade+
# Random-effects
(1+year.0|subID), data=DATA, REML=FALSE)
summary(cond_01)
anova(cond_00,cond_01)
LVL2<-summarize(group_by(DATA, subID),
AIS_grade = AIS_grade[1])
LVL2
LVL2<-summarize(group_by(DATA, subID),
AIS_grade = AIS_grade[1])
LVL2
# At the moment, our LVL2 dataframe contains subject IDs and group information.
# Next, lets add the random-effects from our models:
LVL2$RE_int<-ranef(cond_01)$subID$`(Intercept)`
LVL2$RE_year<-ranef(cond_01)$subID$year
LVL2
# Normality ----
# Residuals at Level 1
qqnorm(resid(cond_01))
# Residuals at Level 2
qqnorm(LVL2$RE_int)
qqnorm(LVL2$RE_year)
# Homoscedasticity ----
# Comparable Variances at Level 1
x <- fitted(cond_01)
y <- resid(cond_01)/sd(resid(cond_01))
plot(x=x, y=y, xlab = "Fitted Values", ylab="Standardized Residuals",
ylim=c(-4,4))
# Comparable Variances at Level 2
# Intercepts
LVL2$STD_int<-LVL2$RE_int/sd(LVL2$RE_int)
plot(x=LVL2$AIS_grade, y=LVL2$STD_int,
xlab = "Fitted Values", ylab="Standardized Residuals",
ylim=c(-4,4))
# Slopes
LVL2$STD_year<-LVL2$RE_year/sd(LVL2$RE_year)
plot(x=LVL2$AIS_grade, y=LVL2$STD_year,
xlab = "Fitted Values", ylab="Standardized Residuals",
ylim=c(-4,4))
# Influential Participants ----
# Residuals at Level 1
plot(DATA$subID, resid(cond_01)/sd(resid(cond_01)),
ylab="Standardized Residuals", xlab="Subject ID",
ylim=c(-4,4))
# Residuals at Level 2
# Variation in Intercepts
plot(x=LVL2$subID, y=LVL2$STD_int,
xlab="Subject ID", ylab="Standardized Residual",
ylim=c(-4,4))
# Variation in Slopes
plot(x=LVL2$subID, y=LVL2$STD_year,
xlab="Subject ID", ylab="Standardized Residual",
ylim=c(-4,4))
# Loading the essential libraries.
library("ggplot2"); library("lme4"); library("car"); library("dplyr"); library("lmerTest");
##----------------------- Data Cleaning and QA ---------------------------------
## Setting the Directory -------------------------------------------------------
getwd()
setwd("C:/Users/u6015231/Documents/GitHub/LMER_Clinical_Science/data/")
list.files()
# Import the .csv file into R.
# We will save this file in the R environment as an object called "DATA".
DATA<-read.csv("./data_session2.csv", header = TRUE, sep=",",
na.strings=c("NA","NaN"," ",""))
## FIM scores by group and time -----------------------------------------------
g1<-ggplot(DATA, aes(x = month, y = rasch_FIM)) +
geom_point(aes(fill=as.factor(subID)), pch=21, size=2, stroke=1.25) +
geom_line(aes(group=subID)) +
facet_wrap(~AIS_grade)
g2<-g1+scale_x_continuous(name = "Time from Admission (Months)", breaks=c(0:18)) +
scale_y_continuous(name = "Rasch-Scaled FIM Score (0-100)",limits=c(0,100))
g3 <- g2 + theme_bw() +
theme(axis.text=element_text(size=14, colour="black"),
axis.title=element_text(size=14,face="bold")) +
theme(strip.text.x = element_text(size = 14))+
theme(legend.position="none")
plot(g3)
# We can see that these patterns are almost certainly not linear:
first6<-DATA[c(1:108),]
g1<-ggplot(first6, aes(x = month, y = rasch_FIM)) +
geom_point(aes(fill=as.factor(subID)), pch=21, size=2, stroke=1.25) +
geom_line() +
stat_smooth(method=lm, se=FALSE)+
facet_wrap(~subID)
g2<-g1+scale_x_continuous(name = "Time from Admission (Months)", breaks=c(0:18)) +
scale_y_continuous(name = "Rasch-Scaled FIM Score (0-100)",limits=c(0,100))+
ggtitle("Linear Effect of Time")
g3 <- g2 + theme_bw() +
theme(plot.title = element_text(size=16, face="bold", hjust=0.5),
axis.text=element_text(size=14, colour="black"),
axis.title=element_text(size=14,face="bold"),
strip.text.x = element_text(size = 14),
legend.position="none")
plot(g3)
# Visually, we can test the effect of adding a quadratic effect to the model
g1<-ggplot(first6, aes(x = month, y = rasch_FIM)) +
geom_point(aes(fill=as.factor(subID)), pch=21, size=2, stroke=1.25) +
geom_line() +
stat_smooth(method=lm, formula = y~x+I(x^2), se=FALSE)+
facet_wrap(~subID)
g2<-g1+scale_x_continuous(name = "Time from Admission (Months)", breaks=c(0:18)) +
scale_y_continuous(name = "Rasch-Scaled FIM Score (0-100)",limits=c(0,100))+
ggtitle("Quadratic Effect of Time")
g3 <- g2 + theme_bw() +
theme(plot.title = element_text(size=16, face="bold", hjust=0.5),
axis.text=element_text(size=14, colour="black"),
axis.title=element_text(size=14,face="bold"),
strip.text.x = element_text(size = 14),
legend.position="none")
plot(g3)
# Further, we can see the effect of adding a cubic effect to the model
g1<-ggplot(first6, aes(x = month, y = rasch_FIM)) +
geom_point(aes(fill=as.factor(subID)), pch=21, size=2, stroke=1.25) +
geom_line() +
stat_smooth(method=lm, formula = y~x+I(x^2)+I(x^3), se=FALSE)+
facet_wrap(~subID)
g2<-g1+scale_x_continuous(name = "Time from Admission (Months)", breaks=c(0:18)) +
scale_y_continuous(name = "Rasch-Scaled FIM Score (0-100)",limits=c(0,100))+
ggtitle("Cubic Effect of Time")
g3 <- g2 + theme_bw() +
theme(plot.title = element_text(size=16, face="bold", hjust=0.5),
axis.text=element_text(size=14, colour="black"),
axis.title=element_text(size=14,face="bold"),
strip.text.x = element_text(size = 14),
legend.position="none")
plot(g3)
DATA$year.0_sq<-DATA$year.0^2
DATA$year.0_cu<-DATA$year.0^3
# Linear Effect of Time
time_linear<-lmer(rasch_FIM~
# Fixed-effects
1+year.0+
# Random-effects
(1+year.0|subID), data=DATA, REML=FALSE)
summary(time_linear)
# Quadratic Effect of Time
time_square<-lmer(rasch_FIM~
# Fixed-effects
1+year.0+year.0_sq+
# Random-effects
(1+year.0+year.0_sq|subID), data=DATA, REML=FALSE)
summary(time_square)
# Cubic Effect of Time
time_cube<-lmer(rasch_FIM~
# Fixed-effects
1+year.0+year.0_sq+year.0_cu+
# Random-effects
(1+year.0+year.0_sq+year.0_cu|subID), data=DATA, REML=FALSE)
summary(time_cube)
# Cubic Effect of Time
time_cube<-lmer(rasch_FIM~
# Fixed-effects
1+year.0+year.0_sq+year.0_cu+
# Random-effects
(1+year.0+year.0_sq+year.0_cu|subID), data=DATA, REML=FALSE)
summary(time_cube)
DATA$year.0_cu<-DATA$year.0^3
# Linear Effect of Time
time_linear<-lmer(rasch_FIM~
# Fixed-effects
1+year.0+
# Random-effects
(1+year.0|subID), data=DATA, REML=FALSE)
summary(time_linear)
# Quadratic Effect of Time
time_square<-lmer(rasch_FIM~
# Fixed-effects
1+year.0+year.0_sq+
# Random-effects
(1+year.0+year.0_sq|subID), data=DATA, REML=FALSE)
summary(time_square)
# Cubic Effect of Time
time_cube<-lmer(rasch_FIM~
# Fixed-effects
1+year.0+year.0_sq+year.0_cu+
# Random-effects
(1+year.0+year.0_sq+year.0_cu|subID), data=DATA, REML=FALSE)
# Cubic Effect of Time
time_cube<-lmer(rasch_FIM~
# Fixed-effects
1+year.0+year.0_sq+year.0_cu+
# Random-effects
(1+year.0+year.0_sq|subID), data=DATA, REML=FALSE)
summary(time_cube)
# Cubic Effect of Time
time_cube<-lmer(rasch_FIM~
# Fixed-effects
1+year.0+year.0_sq+year.0_cu+
# Random-effects
(1+year.0+year.0_sq+year.0_cu|subID), data=DATA, REML=FALSE)
summary(time_cube)
anova(time_linear, time_square, time_cube)
# Cubic Effect of Time
time_cube<-lmer(rasch_FIM~
# Fixed-effects
1+year.0+year.0_sq+year.0_cu+
# Random-effects
(1+year.0+year.0_sq+year.0_cu|subID), data=DATA, REML=FALSE)
summary(time_cube)
# Cubic Effect of Time
time_cube<-lmer(rasch_FIM~
# Fixed-effects
1+year.0+year.0_sq+year.0_cu+
# Random-effects
(1+year.0+year.0_sq|subID), data=DATA, REML=FALSE)
summary(time_cube)
# Cubic Effect of Time
time_cube<-lmer(rasch_FIM~
# Fixed-effects
1+year.0+year.0_sq+year.0_cu+
# Random-effects
(1+year.0+year.0_sq+year.0_cu|subID), data=DATA, REML=FALSE)
summary(time_cube)
anova(time_linear, time_square, time_cube)
# Cubic Fixed-Effect Only
time_cube_fixed<-lmer(rasch_FIM~
# Fixed-effects
1+year.0+year.0_sq+year.0_cu+
# Random-effects
(1+year.0+year.0_sq|subID), data=DATA, REML=FALSE)
anova(time_cube_fixed, time_cube)
# Effect of AIS Grade on Time
cond_01<-lmer(rasch_FIM~
# Fixed-effects
1+year.0*AIS_grade+year.0_sq+year.0_cu+
# Random-effects
(1+year.0+year.0_sq+year.0_cu|subID), data=DATA, REML=FALSE)
summary(cond_01)
# Effect of AIS Grade on Quadratic Time
cond_02<-lmer(rasch_FIM~
# Fixed-effects
1+year.0*AIS_grade+year.0_sq*AIS_grade+year.0_cu+
# Random-effects
(1+year.0+year.0_sq+year.0_cu|subID), data=DATA, REML=FALSE)
summary(cond_02)
# Effect of AIS Grade on Cubic Time
cond_03<-lmer(rasch_FIM~
# Fixed-effects
1+year.0*AIS_grade+year.0_sq*AIS_grade+year.0_cu*AIS_grade+
# Random-effects
(1+year.0+year.0_sq+year.0_cu|subID), data=DATA, REML=FALSE)
summary(cond_03)
# Comparing between Models
anova(cond_01, cond_02, cond_03)
# Effect of AIS Grade on Time
cond_01<-lmer(rasch_FIM~
# Fixed-effects
1+year.0*AIS_grade+year.0_sq+year.0_cu+
# Random-effects
(1+year.0+year.0_sq+year.0_cu|subID), data=DATA, REML=FALSE)
summary(cond_01)
summary(cond_03)
# Loading the essential libraries.
library("ggplot2"); library("lme4"); library("car"); library("dplyr"); library("lmerTest");
##----------------------- Data Cleaning and QA ---------------------------------
## Setting the Directory -------------------------------------------------------
getwd()
setwd("C:/Users/USERNAME/Box Sync/Collaboration/")
# Loading the essential libraries.
library("ggplot2"); library("lme4"); library("car"); library("dplyr"); library("lmerTest");
setwd("~/GitHub/LMER_Clinical_Science/data")
list.files()
# Import the .csv file into R.
# We will save this file in the R environment as an object called "DATA".
DATA<-read.csv("./data_session3.csv", header = TRUE, sep=",",
na.strings=c("NA","NaN"," ",""))
# Use the head() function to check the structure of the data file.
head(DATA)
## ------------------- Visualizing Missing Data --------------------------------
## FIM scores with complete data -----------------------------------------------
g1<-ggplot(DATA, aes(x = month, y = rasch_FIM)) +
geom_point(aes(fill=as.factor(subID)), pch=21, size=2, stroke=1.25) +
geom_line(aes(group=subID)) +
facet_wrap(~AIS_grade)
g2<-g1+scale_x_continuous(name = "Time from Admission (Months)", breaks=c(0:18)) +
scale_y_continuous(name = "Rasch-Scaled FIM Score (0-100)",limits=c(0,100))
g3 <- g2 + theme_bw() +
theme(axis.text=element_text(size=14, colour="black"),
axis.title=element_text(size=14,face="bold")) +
theme(strip.text.x = element_text(size = 14))+
theme(legend.position="none")
plot(g3)
## FIM scores with data missing random -----------------------------------------
g1<-ggplot(DATA, aes(x = month, y = rasch_FIM_MAR)) +
geom_point(aes(fill=as.factor(subID)), pch=21, size=2, stroke=1.25) +
geom_line(aes(group=subID)) +
facet_wrap(~AIS_grade)
g2<-g1+scale_x_continuous(name = "Time from Admission (Months)", breaks=c(0:18)) +
scale_y_continuous(name = "Rasch-Scaled FIM Score (0-100)",limits=c(0,100))
g3 <- g2 + theme_bw() +
theme(axis.text=element_text(size=14, colour="black"),
axis.title=element_text(size=14,face="bold")) +
theme(strip.text.x = element_text(size = 14))+
theme(legend.position="none")
plot(g3)
## FIM scores with data missing not at  random ---------------------------------
g1<-ggplot(DATA, aes(x = month, y = rasch_FIM_MNAR)) +
geom_point(aes(fill=as.factor(subID)), pch=21, size=2, stroke=1.25) +
geom_line(aes(group=subID)) +
facet_wrap(~AIS_grade)
g2<-g1+scale_x_continuous(name = "Time from Admission (Months)", breaks=c(0:18)) +
scale_y_continuous(name = "Rasch-Scaled FIM Score (0-100)",limits=c(0,100))
g3 <- g2 + theme_bw() +
theme(axis.text=element_text(size=14, colour="black"),
axis.title=element_text(size=14,face="bold")) +
theme(strip.text.x = element_text(size = 14))+
theme(legend.position="none")
plot(g3)
## FIM scores with Last Observation Carried Forward ----------------------------
g1<-ggplot(DATA, aes(x = month, y = rasch_FIM_LOCF)) +
geom_point(aes(fill=as.factor(subID)), pch=21, size=2, stroke=1.25) +
geom_line(aes(group=subID)) +
facet_wrap(~AIS_grade)
g2<-g1+scale_x_continuous(name = "Time from Admission (Months)", breaks=c(0:18)) +
scale_y_continuous(name = "Rasch-Scaled FIM Score (0-100)",limits=c(0,100))
g3 <- g2 + theme_bw() +
theme(axis.text=element_text(size=14, colour="black"),
axis.title=element_text(size=14,face="bold")) +
theme(strip.text.x = element_text(size = 14))+
theme(legend.position="none")
plot(g3)
# Loading the essential libraries.
library("ggplot2"); library("lme4"); library("car"); library("dplyr"); library("lmerTest");
# Import the .csv file into R.
# We will save this file in the R environment as an object called "DATA".
DATA<-read.csv("./data_session3.csv", header = TRUE, sep=",",
na.strings=c("NA","NaN"," ",""))
## ------------------- Visualizing Missing Data --------------------------------
## FIM scores with complete data -----------------------------------------------
g1<-ggplot(DATA, aes(x = month, y = rasch_FIM)) +
geom_point(aes(fill=as.factor(subID)), pch=21, size=2, stroke=1.25) +
geom_line(aes(group=subID)) +
facet_wrap(~AIS_grade)
g2<-g1+scale_x_continuous(name = "Time from Admission (Months)", breaks=c(0:18)) +
scale_y_continuous(name = "Rasch-Scaled FIM Score (0-100)",limits=c(0,100))
g3 <- g2 + theme_bw() +
theme(axis.text=element_text(size=14, colour="black"),
axis.title=element_text(size=14,face="bold")) +
theme(strip.text.x = element_text(size = 14))+
theme(legend.position="none")
plot(g3)
## FIM scores with data missing random -----------------------------------------
g1<-ggplot(DATA, aes(x = month, y = rasch_FIM_MAR)) +
geom_point(aes(fill=as.factor(subID)), pch=21, size=2, stroke=1.25) +
geom_line(aes(group=subID)) +
facet_wrap(~AIS_grade)
g2<-g1+scale_x_continuous(name = "Time from Admission (Months)", breaks=c(0:18)) +
scale_y_continuous(name = "Rasch-Scaled FIM Score (0-100)",limits=c(0,100))
g3 <- g2 + theme_bw() +
theme(axis.text=element_text(size=14, colour="black"),
axis.title=element_text(size=14,face="bold")) +
theme(strip.text.x = element_text(size = 14))+
theme(legend.position="none")
plot(g3)
## FIM scores with data missing not at  random ---------------------------------
g1<-ggplot(DATA, aes(x = month, y = rasch_FIM_MNAR)) +
geom_point(aes(fill=as.factor(subID)), pch=21, size=2, stroke=1.25) +
geom_line(aes(group=subID)) +
facet_wrap(~AIS_grade)
g2<-g1+scale_x_continuous(name = "Time from Admission (Months)", breaks=c(0:18)) +
scale_y_continuous(name = "Rasch-Scaled FIM Score (0-100)",limits=c(0,100))
g3 <- g2 + theme_bw() +
theme(axis.text=element_text(size=14, colour="black"),
axis.title=element_text(size=14,face="bold")) +
theme(strip.text.x = element_text(size = 14))+
theme(legend.position="none")
plot(g3)
## FIM scores with Last Observation Carried Forward ----------------------------
g1<-ggplot(DATA, aes(x = month, y = rasch_FIM_LOCF)) +
geom_point(aes(fill=as.factor(subID)), pch=21, size=2, stroke=1.25) +
geom_line(aes(group=subID)) +
facet_wrap(~AIS_grade)
g2<-g1+scale_x_continuous(name = "Time from Admission (Months)", breaks=c(0:18)) +
scale_y_continuous(name = "Rasch-Scaled FIM Score (0-100)",limits=c(0,100))
g3 <- g2 + theme_bw() +
theme(axis.text=element_text(size=14, colour="black"),
axis.title=element_text(size=14,face="bold")) +
theme(strip.text.x = element_text(size = 14))+
theme(legend.position="none")
plot(g3)
## -------------------- Identifying Missing Data -------------------------------
# Missing at Random
DATA$MAR_missing<-as.numeric(is.na(DATA$rasch_FIM_MAR))
summary(DATA$MAR_missing)
xtabs(MAR_missing ~ month, DATA)
x<-as.data.frame(xtabs(MAR_missing ~ month, DATA))
x
g1<-ggplot(x, aes(x = month, y=Freq)) +
geom_col(fill= "light grey", color="black")
g2<-g1+scale_x_discrete(name = "Time from Admission (Months)") +
scale_y_continuous(name = "Count of Missing Data", limits=c(0,40))
g3 <- g2 + theme_bw() +
theme(axis.text=element_text(size=14, colour="black"),
axis.title=element_text(size=14,face="bold")) +
theme(strip.text.x = element_text(size = 14))+
theme(legend.position="none")
plot(g3)
# Missing Not at Random
DATA$MNAR_missing<-as.numeric(is.na(DATA$rasch_FIM_MNAR))
summary(DATA$MNAR_missing)
xtabs(MNAR_missing ~ month, DATA)
y<-as.data.frame(xtabs(MNAR_missing ~ month, DATA))
y
g1<-ggplot(y, aes(x = month, y=Freq)) +
geom_col(fill= "light grey", color="black")
g2<-g1+scale_x_discrete(name = "Time from Admission (Months)") +
scale_y_continuous(name = "Count of Missing Data", limits=c(0,40))
g3 <- g2 + theme_bw() +
theme(axis.text=element_text(size=14, colour="black"),
axis.title=element_text(size=14,face="bold")) +
theme(strip.text.x = element_text(size = 14))+
theme(legend.position="none")
plot(g3)
## -------------- The Effects of Missingness on Time ---------------------------
# Cubic model with complete data
complete<-lmer(rasch_FIM~
# Fixed-effects
1+year.0+year.0_sq+year.0_cu+
# Random-effects
(1+year.0+year.0_sq+year.0_cu|subID), data=DATA, REML=FALSE)
# Cubic model with data Missing at Random
MAR<-lmer(rasch_FIM_MAR~
# Fixed-effects
1+year.0+year.0_sq+year.0_cu+
# Random-effects
(1+year.0+year.0_sq+year.0_cu|subID), data=DATA, REML=FALSE)
# Cubic model with data Missing Not at Random
MNAR<-lmer(rasch_FIM_MNAR~
# Fixed-effects
1+year.0+year.0_sq+year.0_cu+
# Random-effects
(1+year.0+year.0_sq+year.0_cu|subID), data=DATA, REML=FALSE)
# Cubic model with Last Observation Carried Forward
LOCF<-lmer(rasch_FIM_LOCF~
# Fixed-effects
1+year.0+year.0_sq+year.0_cu+
# Random-effects
(1+year.0+year.0_sq+year.0_cu|subID), data=DATA, REML=FALSE)
