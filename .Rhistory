summarise(
num_flights = n(),
carriers = n_distinct(carrier)) %>%
arrange(desc(carriers))
not_cancelled %>%
group_by(dest) %>%
summarise(
num_flights = n(),
carriers = n_distinct(carrier),
carrier2 = length(unique(carrier))) %>%
arrange(desc(carriers))
not_cancelled %>%
group_by(year, month, day) %>%
summarise(n_early = sum(dep_time < 500))
not_cancelled %>%
group_by(year, month, day) %>%
summarise(hour_perc = mean(arr_delay > 60))
daily <- group_by(flights, year, month, day)
(per_day   <- summarise(daily, flights = n())) # ???
(per_month <- summarise(per_day, flights = sum(flights))) # ???
(per_year  <- summarise(per_month, flights = sum(flights)))
daily <- group_by(flights, day)
(per_day   <- summarise(daily, flights = n())) # ???
(per_month <- summarise(per_day, flights = sum(flights))) # ???
(per_year  <- summarise(per_month, flights = sum(flights)))
daily <- group_by(flights, year, month, day)
(per_day   <- summarise(daily, flights = n())) # ???
(per_month <- summarise(per_day, flights = sum(flights))) # ???
(per_year  <- summarise(per_month, flights = sum(flights)))
flights %>%
group_by(flight) %>%
summarize(early15 = sum(arr_delay <= -15, na.rm = TRUE),
late15 = sum(arr_delay >= 15, na.rm = TRUE)) %>%
filter(early15 == 0.5,
late15 == 0.5)
flights %>%
group_by(flight) %>%
summarize(early_15_min = sum(arr_delay <= -15, na.rm = TRUE) / n(),
late_15_min = sum(arr_delay >= 15, na.rm = TRUE) / n()) %>%
filter(early_15_min == 0.5,
late_15_min == 0.5)
flights %>%
group_by(flight) %>%
summarize(early_15_min = sum(arr_delay <= -15, na.rm = TRUE) / n(),
late_15_min = sum(arr_delay >= 15, na.rm = TRUE) / n()) %>%
filter(early_15_min == 0.5,
late_15_min == 0.5)
flights %>%
group_by(flight) %>%
summarize(late10 = sum(arr_delay == 10, na.rm = TRUE) / n()) %>%
filter(late10 == 1)
flights %>%
group_by(flight) %>%
summarize(early30 = sum(arr_delay <= -30, na.rm = TRUE) / n(),
late30 = sum(arr_delay >= 30, na.rm = TRUE) / n()) %>%
filter(early30 == 0.5,
late30 == 0.5)
flights %>%
group_by(flight) %>%
summarize(ontime = sum(arr_delay == 0, na.rm = TRUE) / n(),
late = sum(arr_delay >= 120, na.rm = TRUE) / n()) %>%
filter(ontime == .99,
late == .01)
x<-c(1:10)
y<-c(11:20)
z<-rnorm(10,0,1)
data<-data.frame(x,y,z)
data
k<-c(2,0.5,0)
data*k
data*t(k)
k
t(k)
data<-data.frame(x,y,z)
data
data*t(k)
library(nycflights13)
library(tidyverse)
flights %>%
group_by(tailnum) %>%
summarize(flights_on_time = sum(arr_delay = 0, na.rm = TRUE) / n(),
mean_arr_delay = mean(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(flights_on_time, desc(mean_arr_delay))
flights %>% # why has <= 30 been used to define the delay?
group_by(tailnum) %>%
summarize(prop_on_time = sum(arr_delay <= 30, na.rm = TRUE) / n(),
mean_arr_delay = mean(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(prop_on_time, desc(mean_arr_delay))
head(flights)
summary(flight$arr_delay)
summary(flights$arr_delay)
flights %>%
group_by(tailnum) %>%
summarize(flights_on_time = sum(arr_delay = 0, na.rm = TRUE) / n(),
mean_arr_delay = mean(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(flights_on_time, desc(mean_arr_delay))
flights$arr_delay==0
sum(as.numeric(flights$arr_delay==0))
sum(as.numeric(flights$arr_delay==0), na.rm=TRUE)
flights %>%
group_by(tailnum) %>%
summarize(flights_on_time = sum(arr_delay = 0, na.rm = TRUE) / n(),
mean_arr_delay = mean(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(flights_on_time, desc(mean_arr_delay))
flights %>%
group_by(tailnum) %>%
summarize(flights_on_time = sum(arr_delay == 0, na.rm = TRUE) / n(),
mean_arr_delay = mean(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(flights_on_time, desc(mean_arr_delay))
flights %>%
group_by(tailnum) %>%
summarize(flights_on_time = sum(arr_delay == 0, na.rm = TRUE),
mean_arr_delay = mean(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(flights_on_time, desc(mean_arr_delay))
flights %>%
group_by(tailnum) %>%
summarize(flights_on_time = sum(arr_delay == 0, na.rm = TRUE),
mean_arr_delay = mean(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(flights_on_time, mean_arr_delay)
flights %>%
group_by(tailnum) %>%
summarize(flights_on_time = sum(arr_delay == 0, na.rm = TRUE),
mean_arr_delay = mean(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(flights_on_time, desc(arr_delay))
flights %>%
group_by(tailnum) %>%
summarize(flights_on_time = sum(arr_delay == 0, na.rm = TRUE),
mean_arr_delay = mean(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(flights_on_time, desc(flights_on_time))
flights %>%
group_by(tailnum) %>%
summarize(flights_on_time = sum(arr_delay == 0, na.rm = TRUE),
mean_arr_delay = mean(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(flights_on_time, flights_on_time)
flights %>%
group_by(tailnum) %>%
summarize(flights_on_time = sum(arr_delay == 0, na.rm = TRUE),
mean_arr_delay = mean(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(flights_on_time)
flights %>%
group_by(tailnum) %>%
summarize(flights_on_time = sum(arr_delay == 0, na.rm = TRUE),
mean_arr_delay = mean(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(desc(flights_on_time))
flights %>%
group_by(tailnum) %>%
summarize(flights_on_time = sum(arr_delay == 0, na.rm = TRUE) / n(),
mean_arr_delay = mean(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(desc(flights_on_time))
flights %>% # why has <= 30 been used to define the delay?
group_by(tailnum) %>%
summarize(prop_on_time = sum(arr_delay <= 30, na.rm = TRUE) / n(),
mean_arr_delay = mean(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(prop_on_time, desc(mean_arr_delay))
flights %>% # why has <= 30 been used to define the delay?
group_by(tailnum) %>%
summarize(prop_on_time = sum(arr_delay <= 5, na.rm = TRUE) / n(),
mean_arr_delay = mean(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(prop_on_time, desc(mean_arr_delay))
flights %>% # why has <= 30 been used to define the delay?
group_by(tailnum) %>%
summarize(prop_on_time = sum(arr_delay <= 30, na.rm = TRUE) / n(),
mean_arr_delay = mean(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(prop_on_time, desc(mean_arr_delay))
flights %>% # why has <= 30 been used to define the delay?
group_by(tailnum) %>%
summarize(prop_on_time = sum(arr_delay <= 60, na.rm = TRUE) / n(),
mean_arr_delay = mean(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(prop_on_time, desc(mean_arr_delay))
flights %>% # why has <= 30 been used to define the delay?
group_by(tailnum) %>%
summarize(prop_under60 = sum(arr_delay <= 60, na.rm = TRUE) / n(),
mean_arr_delay = mean(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(prop_under60, desc(mean_arr_delay))
flights %>% # why has <= 30 been used to define the delay?
group_by(tailnum) %>%
summarize(prop_under100 = sum(arr_delay <= 100, na.rm = TRUE) / n(),
mean_arr_delay = mean(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(prop_under100, desc(mean_arr_delay))
flights %>% # why has <= 30 been used to define the delay?
group_by(tailnum) %>%
summarize(prop_under200 = sum(arr_delay <= 200, na.rm = TRUE) / n(),
mean_arr_delay = mean(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(prop_under200, desc(mean_arr_delay))
flights %>% # why has <= 30 been used to define the delay?
group_by(tailnum) %>%
summarize(prop_under30 = sum(arr_delay <= 30, na.rm = TRUE) / n(),
mean_arr_delay = mean(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(prop_under30, desc(mean_arr_delay))
flights$arr_delay <= 30
sum(flights$arr_delay <= 30)
sum(flights$arr_delay <= 30, na.rm=TRUE)
sum(flights$arr_delay <= 30, na.rm=TRUE)/length(flights$arr_delay)
flights %>% # why has <= 30 been used to define the delay?
group_by(tailnum) %>%
summarize(prop_under30 = sum(arr_delay <= 30, na.rm = TRUE) / n(),
mean_arr_delay = mean(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(desc(prop_under30), desc(mean_arr_delay))
subset(flights, tailnum == "N663UA")
x<-subset(flights, tailnum == "N663UA")
length(x$arr_delay)
mean(x$arr_delay)
x$arr_delay <= 30
x$arr_delay <= 30 / length(x$arr_delay)
sum(x$arr_delay <= 30) / length(x$arr_delay)
flights %>% # why has <= 30 been used to define the delay?
group_by(tailnum) %>%
summarize(prop_under30 = sum(arr_delay <= 30, na.rm = TRUE) / n(),
mean_arr_delay = mean(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(prop_under30, desc(mean_arr_delay))
flights %>% # why has <= 30 been used to define the delay?
group_by(tailnum) %>%
summarize(prop_under30 = sum(arr_delay <= 30, na.rm = TRUE) / n(),
mean_arr_delay = mean(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(prop_under30, desc(mean_arr_delay))
flights %>% # why has <= 30 been used to define the delay?
group_by(tailnum) %>%
summarize(prop_under146 = sum(arr_delay <= 146, na.rm = TRUE) / n(),
mean_arr_delay = mean(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(prop_under146, desc(mean_arr_delay))
flights %>% # why has <= 30 been used to define the delay?
group_by(tailnum) %>%
summarize(prop_under0 = sum(arr_delay <= 0, na.rm = TRUE) / n(),
mean_arr_delay = mean(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(prop_under0, desc(mean_arr_delay))
flights %>% # why has <= 30 been used to define the delay?
group_by(tailnum) %>%
summarize(prop_under0 = sum(arr_delay <= 0, na.rm = TRUE) / n(),
mean_arr_delay = mean(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(desc(prop_under0), desc(mean_arr_delay))
flights %>% # why has <= 30 been used to define the delay?
group_by(tailnum) %>%
summarize(prop_under0 = sum(arr_delay <= 30, na.rm = TRUE) / n(),
mean_arr_delay = mean(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(desc(prop_under0), desc(mean_arr_delay))
flights %>% # why has <= 30 been used to define the delay?
group_by(tailnum) %>%
summarize(prop_under0 = sum(arr_delay <= 0, na.rm = TRUE) / n(),
mean_arr_delay = mean(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(desc(prop_under0), desc(mean_arr_delay))
flights %>%
group_by(hour) %>%
summarize(arr_delay = sum(arr_delay > 5, na.rm = TRUE) / n()) %>%
ggplot(aes(x = hour, y = arr_delay))+
geom_line()
flights %>%
group_by(hour) %>%
summarize(prop_delayed = sum(arr_delay > 5, na.rm = TRUE) / n()) %>%
ggplot(aes(x = hour, y = prop_delayed))+
geom_line()
flights %>%
group_by(hour) %>%
summarize(prop_delayed = sum(arr_delay > 5, na.rm = TRUE) / n()) %>%
ggplot(aes(x = hour, y = prop_delayed))+
geom_point()
flights %>%
group_by(hour) %>%
summarize(prop_delayed = sum(arr_delay > 5, na.rm = TRUE) / n()) %>%
ggplot(aes(x = hour, y = prop_delayed))+
geom_line()
flights %>%
ggplot(aes(x=factor(hour), fill=arr_delay>5 | is.na(arr_delay))) + geom_bar()
flights %>%
group_by(hour) %>%
summarize(prop_delayed = sum(arr_delay > 5, na.rm = TRUE) / n()) %>%
ggplot(aes(x = hour, y = prop_delayed))+
geom_line()
flights %>%
group_by(dest) %>%
summarize(delay_by_dest = sum(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(delay_by_dest)
flights %>%
group_by(dest) %>%
group_by(tailnum) %>%
summarize(delay_by_dest = sum(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(delay_by_dest)
flights %>%
group_by(dest) %>%
group_by(tailnum) %>%
summarize(delay_by_dest = sum(arr_delay, na.rm = TRUE),
flights = n(),
dest = [1]) %>%
arrange(delay_by_dest)
flights %>%
group_by(dest) %>%
group_by(tailnum) %>%
summarize(delay_by_dest = sum(arr_delay, na.rm = TRUE),
flights = n(),
dest = [1]) %>%
arrange(delay_by_dest)
flights %>%
group_by(dest) %>%
group_by(tailnum) %>%
summarize(delay_by_dest = sum(arr_delay, na.rm = TRUE),
flights = n(),
desintation = dest[1]) %>%
arrange(delay_by_dest)
flights %>%
group_by(dest) %>%
group_by(tailnum) %>%
summarize(desintation = dest[1]),
delay_by_dest = sum(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(delay_by_dest)
flights %>%
group_by(dest) %>%
group_by(tailnum) %>%
summarize(desintation = dest[1],
delay_by_dest = sum(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(delay_by_dest)
flights %>%
group_by(dest) %>%
group_by(tailnum) %>%
summarize(desintation = dest[1],
delay_by_dest = sum(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(destination, tailnum)
flights %>%
group_by(dest) %>%
group_by(tailnum) %>%
summarize(destintation = dest[1],
delay_by_dest = sum(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(destination, tailnum)
flights %>%
group_by(dest) %>%
group_by(tailnum) %>%
summarize(destination = dest[1],
delay_by_dest = sum(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(destination, tailnum)
x<-flights %>%
group_by(dest) %>%
group_by(tailnum) %>%
summarize(destination = dest[1],
delay_by_dest = sum(arr_delay, na.rm = TRUE),
flights = n()) %>%
arrange(destination, tailnum)
x<-flights %>%
group_by(dest) %>%
group_by(tailnum) %>%
summarize(destination = dest[1],
delay_by_dest = sum(arr_delay, na.rm = TRUE),
tn_flights = n()) %>%
arrange(destination, tailnum)
flights %>%
group_by(dest) %>%
summarize(delay_by_dest = sum(arr_delay, na.rm = TRUE),
dest_flights = n()) %>%
arrange(destination)
flights %>%
group_by(dest) %>%
summarize(delay_by_dest = sum(arr_delay, na.rm = TRUE),
dest_flights = n())
y<-flights %>%
group_by(dest) %>%
summarize(delay_by_dest = sum(arr_delay, na.rm = TRUE),
dest_flights = n())
x<-flights %>%
group_by(dest) %>%
group_by(tailnum) %>%
summarize(dest = dest[1],
delay_by_dest = sum(arr_delay, na.rm = TRUE),
tn_flights = n()) %>%
arrange(dest, tailnum)
y<-flights %>%
group_by(dest) %>%
summarize(delay_by_dest = sum(arr_delay, na.rm = TRUE),
dest_flights = n())
head(x)
head(y)
z<-merge(x,y,by=c("dest"))
head(z)
x<-flights %>%
group_by(dest) %>%
group_by(tailnum) %>%
summarize(dest = dest[1],
delay_for_flight = sum(arr_delay, na.rm = TRUE),
tn_flights = n()) %>%
arrange(dest, tailnum)
y<-flights %>%
group_by(dest) %>%
summarize(delay_at_dest = sum(arr_delay, na.rm = TRUE),
dest_flights = n())
head(x)
head(y)
z<-merge(x,y,by=c("dest"))
head(z)
z$prop_delay<-z$delay_for_flight/z$delay_at_dest
head(z)
flights %>%
group_by(origin) %>%
arrange(year, month, day, hour, minute) # %>%
k<-c(1:10)
k
lag(k)
flights %>%
group_by(origin) %>%
arrange(year, month, day, hour, minute) %>%
mutate(prev_dep_delay = lag(dep_delay)) %>%
ggplot(aes(x = prev_dep_delay, y = dep_delay)) +
geom_point() +
geom_smooth()
flights %>%
group_by(origin) %>%
arrange(year, month, day, hour, minute) %>%
mutate(prev_dep_delay = lag(dep_delay)) %>%
ggplot(aes(x = prev_dep_delay, y = dep_delay)) +
geom_point() +
geom_smooth() +
scale_x_continuous(limits=c(0,100))+scale_y_continuous(limits=c(0,100))
getwd()
setwd("C:/Users/krl0022/Documents/GitHub/LMER_Clinical_Science/")
list.files()
list.files("./data/")
library("ggplot2");library("lme4");library("dplyr");library("AICcmodavg")
install.packages("ggplot2")
library("ggplot2");library("lme4");library("dplyr");library("AICcmodavg")
DATA<-read.csv("./data/data_LOHSE_EXAMPLE.csv", header = TRUE)
DATA #Clearly the raw data is a bit of a mess, but notice NAs in multiple rows
B0<-lmer(BERG~1+(1|subID),data=DAT2, REML=FALSE)
summary(B0)
B1<-lmer(BERG~1+time+(1+time|subID),data=DAT2, REML=FALSE)
DAT2<-subset(DAT2, subID != "p11") # drops all of #11's data
summary(DAT2$subID)
DAT2$subID<-factor(DAT2$subID)
summary(DAT2$subID)
DAT2<-subset(DATA, time != -1)
head(DAT2)
summary(as.factor(DAT2$time))
B0<-lmer(BERG~1+(1|subID),data=DAT2, REML=FALSE)
summary(B0)
myX<-scale_x_continuous(breaks = 0:12,
name = "Time (Months from OutPatient Admission)")
myY<-scale_y_continuous(name = "10m Walk Test")
g1<-ggplot(data=DAT2, aes(x = time, y = BERG, group = subID))
g2<-g1+geom_point()+facet_wrap(~subID)+myX+myY
plot(g2)
g3<-g2+geom_hline(aes(yintercept=mean(BERG))
# In our Random Slopes model, we estimate an intercept and a slope for each
# participant and an overall intercept and slope. These overall intercepts
# and slopes are the fixed-effects, and deviations away from these values are
# random-effects.
B1<-lmer(BERG~1+time+(1+time|subID),data=DAT2, REML=FALSE)
# yij = BO + U0j + (B1+ U1j)*(TIMEij) + Eij
summary(B1)
myX<-scale_x_continuous(name = "Time (Months from Outpatient Admission)")
myY<-scale_y_continuous(name = "Berg Balance Scale Score", limits=c(0,60))
g1 <- ggplot(data = DAT2, aes(x = time, y = BERG, group=subID)) + geom_point(aes(col=subID))
g2 <- g1 + geom_smooth(method=lm, se=FALSE, aes(color=subID)) + myX + myY
g3 <- g2 + geom_abline(intercept=28.896, slope=2.1749, aes(col="black", size=5))
print(g3)
# Adding in additional Fixed Effects of Interest
B2<-lmer(BERG~1+time*DPS.c+(1+time|subID),data=DAT2, REML=FALSE)
summary(B2)
B3<-lmer(BERG~1+time*DPS.c+time*Age.c+(1+time|subID),data=DAT2, REML=FALSE)
summary(B3)
anova(B0,B1,B2,B3,B4,B5)
g3<-g2+geom_hline(aes(yintercept=mean(BERG)))
g3
myX<-scale_x_continuous(breaks = 0:12,
name = "Time (Months from OutPatient Admission)")
myY<-scale_y_continuous(name = "10m Walk Test")
g1<-ggplot(data=DAT2, aes(x = time, y = BERG, group = subID))
g2<-g1+geom_point()+facet_wrap(~subID)+myX+myY
g3<-g2+geom_hline(aes(yintercept=mean(BERG)))
plot(g3)
fitted(B0)
g3<-g2+geom_hline(aes(yintercept=c(19.78, 4.54, 41.84, 42.99, 19.64, 13.47,
42.01,24.74, 49.11, 49.85, 9.74, 48.87)))
plot(g3)
plot(g2)
DAT2$B0_fitted<-fitted(B0)
pred<-data.frame(subID=c("p01","p02","p03","p04","p05","p06","p07","p08","p09",
"p10","p11","p12"),
fitted=c(19.78, 4.54, 41.84, 42.99, 19.64, 13.47, 42.01, 24.74,
49.11, 49.85, 9.74, 48.87))
g3<-g2+geom_hline(aes(yintercept=fitted), pred)
plot(g3)
install.packages("dplyr")
